#母星系堡垒
create_azur_R_fallen_home_citadel = {
	optimize_memory
	create_starbase = {
		size = "starbase_citadel"

		module = "shipyard"
		module = "shipyard"
		module = "hangar_bay"
		module = "hangar_bay"
		module = "gun_battery"
		module = "gun_battery"

		building = "target_uplink_computer"
		building = "defense_grid"
		building = "colossus_yards"
		building = "titan_yards"

		effect = {
            while = {
				count = 30
				create_ship = {
					name = random
					design = "NAME_AZUR_Cloaker"
					graphical_culture = fallen_empire_03
					upgradable = no
				}
			}
		}
	}
}

#普通星系堡垒
create_azur_R_fallen_citadel = {
	optimize_memory
	create_starbase = {
		size = "starbase_citadel"

		module = "shipyard"
		module = "gun_battery"
		module = "gun_battery"
		module = "gun_battery"
		module = "gun_battery"
		module = "gun_battery"

		building = "target_uplink_computer"
		building = "defense_grid"
		building = "colossus_yards"
		building = "titan_yards"

		effect = {
            while = {
				count = 15
				create_ship = {
					name = random
					design = "NAME_AZUR_Cloaker"
					graphical_culture = fallen_empire_03
					upgradable = no
				}
			}
		}
	}
}

#工程船
create_azur_R_fallen_construction_ship = {	
	optimize_memory
	create_fleet = {
		effect = {
			set_owner = prev.owner
			create_fallen_empire_construction_ship = yes
			set_location = {
				target = prev
				distance = 80
				angle = random
			}
		}
	}					
}

#生成反击meta
create_azur_R_fallen_leader_01 = {
	owner = {
		create_leader = {
			name = 反击
			species = event_target:azur_lane_leader_species	
			class = commander  				#official/scientist/random_ruler/commander
			skill = 1
			traits = {
				trait = leader_trait_azur_R_fanji_meta
			}
			
			gender = female
			set_is_female = yes
			event_leader = no
			hide_age = yes

			skip_background_generation = yes					#跳过背景生成
			custom_catch_phrase = AL_R_fanji_meta_phrase		#自定义
			custom_description = AL_R_fanji_meta_backstory		#背景词
			background_ethic = ethic_militarist					#思潮
		}
		last_created_leader = {
			change_leader_portrait = AL_leader_反击meta
			set_leader_flag = azur_leader_fanji_meta  #领袖标记
			save_global_event_target_as = fanji_meta_leader #保存事件
			#新flag
			set_leader_flag = legendary_leader
			set_leader_flag = immune_to_negative_traits
			set_skill = 30
			add_trait_no_notify = random_common
			remove_all_traits = yes
			add_trait_no_notify = leader_trait_azur_R_fanji_meta
		}
	}
}

#生成声望meta
create_azur_R_fallen_leader_02 = {
	owner = {
		create_leader = {
			name = 声望
			species = event_target:azur_lane_leader_species	
			class = commander  				#official/scientist/random_ruler/commander
			skill = 1
			traits = {
				trait = leader_trait_azur_R_fanji_meta
			}
			
			gender = female
			set_is_female = yes
			event_leader = no
			hide_age = yes
			
			skip_background_generation = yes					#跳过背景生成
			custom_catch_phrase = AL_R_shengwang_meta_phrase		#自定义
			custom_description = AL_R_shengwang_meta_backstory		#背景词
			background_ethic = ethic_militarist					#思潮
		}
		last_created_leader = {
			change_leader_portrait = AL_leader_声望meta
			set_leader_flag = azur_leader_shengwang_meta  #领袖标记
			save_global_event_target_as = shengwang_meta_leader #保存事件
			#新flag
			set_leader_flag = legendary_leader
			set_leader_flag = immune_to_negative_traits
			set_skill = 30
			add_trait_no_notify = random_common
			remove_all_traits = yes
			add_trait_no_notify = leader_trait_azur_R_shengwang_meta
		}
	}
}

#堕落舰队_01
create_azur_R_fallen_leader_fleet_01 = {
	optimize_memory
	create_fleet = {
		effect = {
			set_owner = prev.owner
			while = {
				count = 12
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_TITAN"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 48
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_BATTLE"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 20
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_ESCORTE"
					graphical_culture = "fallen_empire_03"
				}
			}
			random_list = {
				25 = {
					set_location = {
						target = prev
						distance = 10
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 15
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 20
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 25
						angle = random
					}
				}
			}
		}
		settings = { 
			can_upgrade = no 
			can_disband = no
			spawn_debris = yes
			is_boss = yes
			can_change_composition = no
		}
	}
	create_azur_R_fallen_leader_01 = yes
	last_created_fleet = { assign_leader = event_target:fanji_meta_leader }
}

#堕落舰队_02
create_azur_R_fallen_leader_fleet_02 = {
	optimize_memory
	create_fleet = {
		effect = {
			set_owner = prev.owner
			while = {
				count = 12
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_TITAN"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 48
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_BATTLE"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 20
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_ESCORTE"
					graphical_culture = "fallen_empire_03"
				}
			}
			random_list = {
				25 = {
					set_location = {
						target = prev
						distance = 10
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 15
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 20
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 25
						angle = random
					}
				}
			}
		}
		settings = { 
			can_upgrade = no 
			can_disband = no
			spawn_debris = yes
			is_boss = yes
			can_change_composition = no
		}
	}
	create_azur_R_fallen_leader_02 = yes
	last_created_fleet = { assign_leader = event_target:shengwang_meta_leader }
}


#堕落刷船_常规
create_azur_R_fallen_fleet = {
	optimize_memory
	owner = {
		create_leader = {
			class = commander
			species = owner_main_species
			set_is_female = yes
			name = random
			skill = 20
			hide_age = yes
			randomize_traits = yes
		}
	}
	create_fleet = {
		effect = {
			set_owner = prev.owner
			while = {
				count = 5
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_TITAN"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 30
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_BATTLE"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 10
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_ESCORTE"
					graphical_culture = "fallen_empire_03"
				}
			}
			random_list = {
				25 = {
					set_location = {
						target = prev
						distance = 10
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 15
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 20
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 25
						angle = random
					}
				}
			}
		}
		settings = { 
			can_upgrade = no 
			can_disband = no
			spawn_debris = yes
			is_boss = yes
			can_change_composition = no
		}
	}
	last_created_fleet = { assign_leader = last_created_leader }	
}

#堕落刷船_守家
create_azur_R_fallen_home_fleet = {
	optimize_memory
	owner = {
		create_leader = {
			class = commander
			species = owner_main_species
			set_is_female = yes
			name = random
			skill = 20
			hide_age = yes
			randomize_traits = yes
		}
	}
	create_fleet = {
		effect = {
			set_owner = prev.owner
			while = {
				count = 8
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_TITAN"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 40
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_BATTLE"
					graphical_culture = "fallen_empire_03"
				}
			}
			while = {
				count = 10
				create_ship = {
					name = random
					design = "NAME_AZUR_FALLEN_ESCORTE"
					graphical_culture = "fallen_empire_03"
				}
			}
			random_list = {
				25 = {
					set_location = {
						target = prev
						distance = 10
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 15
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 20
						angle = random
					}
				}
				25 = {
					set_location = {
						target = prev
						distance = 25
						angle = random
					}
				}
			}
		}
		settings = { 
			can_upgrade = no 
			can_disband = no
			spawn_debris = no
			is_boss = yes
			can_change_composition = no
		}
	}
	last_created_fleet = { assign_leader = last_created_leader }	
}

#陆军
create_azur_R_fallen_armys = {	
	optimize_memory
	create_fleet = {
		effect = {
			set_owner = prev.owner
			while = {
				count = 10
				create_army_transport = {
					army_name = random
					army_type = "AL_R_army_fallen"
				}
			}
			set_location = {
				target = prev
				distance = 25
				angle = random
			}
		}
	}	
}

#原版修改
synth_queen_fe_war = {
	if = {
		limit = {
			any_country = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				NOT = {
					has_country_flag = azur_R_fallen_empire
				}
			}
		}
		every_country = {
			limit = {
				OR = {
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				NOT = {
					has_country_flag = azur_R_fallen_empire
				}
			}
			declare_war = {
				target = event_target:synth_queen_country_global
				name = cetana_war
				attacker_war_goal = wg_end_threat
			}
		}
		awaken_guardians_of_the_galaxy = yes
	}
	else = {
		country_event = { id = crisis.8045 days = 360 }
	}
}