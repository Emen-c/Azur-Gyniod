#触发器
azur_return_shops = {
	optimize_memory
	hidden_effect = {
		#remove_country_flag = cara_home_convo
		# commented out for reworked cara.100 trigger
		country_event = { id = azur_mingshi.10 }
	}
}

wisedom_get_physics_tech_AL = {
	optimize_memory
	add_random_research_option = { area = physics add_progress = 1.00 ignore_rare = no }
	hidden_effect = { set_timed_country_flag = { flag = wisedom_get_physics_tech_AL_open days = 1800 } }
	custom_tooltip = "随机获得物理学科技，但需要冷却时间,"
}

wisedom_get_society_tech_AL = {
	optimize_memory
	add_random_research_option = { area = society add_progress = 1.00 ignore_rare = no }
	hidden_effect = { set_timed_country_flag = { flag = wisedom_get_society_tech_AL_open days = 1800 } }
	custom_tooltip = "随机获得社会学科技，但需要冷却时间,"
}

wisedom_get_engineering_tech_AL = {
	optimize_memory
	add_random_research_option = { area = engineering add_progress = 1.00 ignore_rare = no }
	hidden_effect = { set_timed_country_flag = { flag = wisedom_get_engineering_tech_AL_open days = 1800 } }
	custom_tooltip = "随机获得工程学科技，但需要冷却时间,"
}

#生成小天城战舰
create_AL_R_tc_warship = {
	optimize_memory
	if = {
		limit = { has_country_flag = al_tc_scientist_active }
		remove_country_flag = al_tc_scientist_active
		event_target:tiancheng = {
			kill_leader = { show_notification = no } 
		}
		remove_modifier = AL_R_tc_scientist
	}
	set_country_flag = al_tc_warship_active
	create_leader = {
		name = 小天城
		species = event_target:azur_lane_leader_species	
		class = commander  				#official/scientist/random_ruler/commander
		skill = 1
		traits = {
			trait = leader_azur_trait_tiancheng_02
		}
		
		gender = female
		set_is_female = yes
		event_leader = no
		custom_catch_phrase = AL_R_tiancheng_phrase			#自定义
		custom_description = AL_R_tiancheng_backstory		#背景词
		background_job = azur_R_leader_job_A
	}
	last_created_leader = {
		change_leader_portrait = AL_R_leader_天城
		set_leader_flag = azur_leader_tiancheng  #领袖标记
		save_global_event_target_as = tiancheng #保存事件
		#新flag
		set_leader_flag = legendary_leader
		set_leader_flag = immune_to_negative_traits
		set_skill = 20
		add_trait_no_notify = random_common
		remove_all_traits = yes
		add_trait_no_notify = leader_azur_trait_tiancheng_02
		set_leader_flag = should_not_have_upkeep
	}
	if = {
		limit = {
			has_country_flag = al_tc_has_shiyue
		}
		event_target:tiancheng = {
			add_trait = leader_azur_trait_shiyue
		}
	}
	if = {
		limit = {
			has_country_flag = azur_R_stage_7_flag
		}
		event_target:tiancheng = {
		#	add_trait = leader_azur_trait_tiancheng_03
		}
	}
	create_fleet = {
		name = "联合旗舰"
		settings = {
			can_upgrade = no
			can_disband = no
			can_change_composition = no
			can_change_leader = no
			uses_naval_capacity = no
			spawn_debris = no
			is_boss = yes
		}
		effect = {
			set_owner = root
			create_ship = {
				name = "天城"
				design = "NAME_AZUR_TIANCHENG_LOLI"
				prefix = no
				upgradable = no
			}
			save_global_event_target_as = AL_R_tc_warship
			assign_leader = event_target:tiancheng
			set_location = root.owner.capital_scope
		}
	}
}

#生成小天城领袖
create_AL_R_tc_scientist = {
	optimize_memory
	if = {
		limit = { has_country_flag = al_tc_warship_active }
		remove_country_flag = al_tc_warship_active
		event_target:tiancheng = { kill_leader = { show_notification = no }  }
		event_target:AL_R_tc_warship = { delete_fleet = this }
	}
	set_country_flag = al_tc_scientist_active
	
	create_leader = {
		name = 小天城
		species = event_target:azur_lane_leader_species	
		class = scientist  				#official/scientist/random_ruler/commander
		skill = 1
		traits = {
			trait = leader_azur_trait_tiancheng_01
		}
		
		gender = female
		set_is_female = yes
		event_leader = no
		custom_catch_phrase = AL_R_tiancheng_phrase			#自定义
		custom_description = AL_R_tiancheng_backstory		#背景词
		background_job = azur_R_leader_job_A
	}
	last_created_leader = {
		change_leader_portrait = AL_R_leader_天城
		set_leader_flag = azur_leader_tiancheng  #领袖标记
		save_global_event_target_as = tiancheng #保存事件
		#新flag
		set_leader_flag = legendary_leader
		set_leader_flag = immune_to_negative_traits
		set_skill = 20
		add_trait_no_notify = random_common
		remove_all_traits = yes
		add_trait_no_notify = leader_azur_trait_tiancheng_01
		set_leader_flag = should_not_have_upkeep
	}
	if = {
		limit = {
			has_country_flag = al_tc_has_shiyue
		}
		event_target:tiancheng = {
			add_trait = leader_azur_trait_shiyue
		}
	}
	add_modifier = {
		modifier = "AL_R_tc_scientist"
		multiplier = trigger:num_researched_techs
	}
}

#武装科研船
create_AL_R_science = {
	optimize_memory
	create_fleet = {
		name = NANODA
		effect = {
			set_owner = root
			create_ship = {
				name = random
				design = "NAME_azur_R_science"
				graphical_culture = owner
			}
			set_location = root.owner.capital_scope
		}
		settings = { 
			can_upgrade = no 
			can_disband = yes
			spawn_debris = no
			is_boss = yes
			can_change_composition = no
		}
	}
}

#测试
AL_R_XI_GIFT_ALL = {
	#grand_archive_relics
	add_relic = r_the_modularium
	add_relic = r_flowmetal_alloy
	add_relic = r_crystallinus_diffuser
	add_relic = r_everchanging_stone
	add_relic = r_pulsestone
	add_relic = r_gavel_of_the_tribunal
	add_relic = r_entangled_relay
	add_relic = r_prototype_vir_core
	add_relic = r_propagandosphere
	add_relic = r_executus_compendium
	add_relic = r_the_pattern_maker
	add_relic = r_vaporous_mega_orchid
	add_relic = r_tiyanki_matriarch_nerve_core
	add_relic = r_preservation_chamber
	add_relic = r_celestial_resonator
	add_relic = r_mutated_voidworm_nest
	add_relic = r_celestial_chart_4
	#relics
	add_relic = r_dragon_trophy
	add_relic = r_khans_throne
	add_relic = r_worm_scales
	add_relic = r_rubricator
	add_relic = r_galaxy
	add_relic = r_omnicodex
	add_relic = r_surveyor
	add_relic = r_galatron
	add_relic = r_ancient_sword
	add_relic = r_severed_head
	add_relic = r_odryskan_crystal
	add_relic = r_the_rulerchip
	add_relic = r_prethoryn_queen
	add_relic = r_unbidden_warlock
	add_relic = r_contingency_core
	add_relic = r_cetanas_heart
	add_relic = r_zro_crystal
	add_relic = r_the_last_baol
	add_relic = r_the_defragmentor
	add_relic = r_reality_perforator
	add_relic = r_pox_sample
	add_relic = r_cryo_core
	add_relic = r_war_forge
	add_relic = r_vacuum_flower
	add_relic = r_toxic_god
	add_relic = r_wormhole_key
	add_relic = r_ever_spinning_top
	add_relic = r_celestial_tear
	add_relic = r_plasmic_core
	add_relic = r_infinity_root
	add_relic = r_time_crystal
	add_relic = r_daedalus_seal
	add_relic = r_continuum
	add_relic = r_eternal_throne
	add_relic = r_weather_manipulator
}

#送文物
AL_R_XI_GIFT = {
	optimize_memory
	locked_random_list = {
		#给遗珍
		1 = {
			locked_random_list = {
				1 = {
					modifier = {
						factor = 0
						has_relic = r_the_modularium
					}
					add_relic = r_the_modularium
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_flowmetal_alloy
					}
					add_relic = r_flowmetal_alloy
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_crystallinus_diffuser
					}
					add_relic = r_crystallinus_diffuser
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_everchanging_stone
					}
					add_relic = r_everchanging_stone
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_pulsestone
					}
					add_relic = r_pulsestone
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_gavel_of_the_tribunal
					}
					add_relic = r_gavel_of_the_tribunal
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_entangled_relay
					}
					add_relic = r_entangled_relay
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_prototype_vir_core
					}
					add_relic = r_prototype_vir_core
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_propagandosphere
					}
					add_relic = r_propagandosphere
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_executus_compendium
					}
					add_relic = r_executus_compendium
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_the_pattern_maker
					}
					add_relic = r_the_pattern_maker
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_vaporous_mega_orchid
					}
					add_relic = r_vaporous_mega_orchid
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_tiyanki_matriarch_nerve_core
					}
					add_relic = r_tiyanki_matriarch_nerve_core
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_preservation_chamber
					}
					add_relic = r_preservation_chamber
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_celestial_resonator
					}
					add_relic = r_celestial_resonator
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_mutated_voidworm_nest
					}
					add_relic = r_mutated_voidworm_nest
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_dragon_trophy
					}
					add_relic = r_dragon_trophy
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_khans_throne
					}
					add_relic = r_khans_throne
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_worm_scales
					}
					add_relic = r_worm_scales
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_rubricator
					}
					add_relic = r_rubricator
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_surveyor
					}
					add_relic = r_surveyor
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_galatron
					}
					add_relic = r_galatron
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_ancient_sword
					}
					add_relic = r_ancient_sword
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_severed_head
					}
					add_relic = r_severed_head
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_odryskan_crystal
					}
					add_relic = r_odryskan_crystal
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_the_rulerchip
					}
					add_relic = r_the_rulerchip
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_prethoryn_queen
					}
					add_relic = r_prethoryn_queen
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_unbidden_warlock
					}
					add_relic = r_unbidden_warlock
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_contingency_core
					}
					add_relic = r_contingency_core
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_cetanas_heart
					}
					add_relic = r_cetanas_heart
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_zro_crystal
					}
					add_relic = r_zro_crystal
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_the_last_baol
					}
					add_relic = r_the_last_baol
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_the_defragmentor
					}
					add_relic = r_the_defragmentor
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_reality_perforator
					}
					add_relic = r_reality_perforator
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_pox_sample
					}
					add_relic = r_pox_sample
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_cryo_core
					}
					add_relic = r_cryo_core
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_war_forge
					}
					add_relic = r_war_forge
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_vacuum_flower
					}
					add_relic = r_vacuum_flower
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_toxic_god
					}
					add_relic = r_toxic_god
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_wormhole_key
					}
					add_relic = r_wormhole_key
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_ever_spinning_top
					}
					add_relic = r_ever_spinning_top
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_plasmic_core
					}
					add_relic = r_plasmic_core
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_infinity_root
					}
					add_relic = r_infinity_root
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_time_crystal
					}
					add_relic = r_time_crystal
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_daedalus_seal
					}
					add_relic = r_daedalus_seal
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_continuum
					}
					add_relic = r_continuum
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_eternal_throne
					}
					add_relic = r_eternal_throne
				}
				1 = {
					modifier = {
						factor = 0
						has_relic = r_weather_manipulator
					}
					add_relic = r_weather_manipulator
				}
			}
		}
		#给资源
		4 = {
			locked_random_list = {
				1 = {
					add_monthly_resource_mult = {
						resource = energy
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = minerals
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = food
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = society_research
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = engineering_research
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = alloys
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = consumer_goods
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = volatile_motes
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = exotic_gases
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = rare_crystals
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = sr_living_metal
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = sr_zro
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = sr_dark_matter
						value = 1
					}
				}
				1 = {
					add_monthly_resource_mult = {
						resource = nanites
						value = 1
					}
				}
			}
		}
	}
}


#原版命定特质
add_leader_destiny_traits_AL_R = {
	if = {
		limit = {
			leader_class = official
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_peacekeeper
				}
				add_trait_no_notify = leader_trait_peacekeeper
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_totalitarian
				}
				add_trait_no_notify = leader_trait_totalitarian
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_educator
				}
				add_trait_no_notify = leader_trait_educator
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_master_bureaucrat
				}
				add_trait_no_notify = leader_trait_master_bureaucrat
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_master_diplomat
				}
				add_trait_no_notify = leader_trait_master_diplomat
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_diplo_weight
				}
				add_trait_no_notify = leader_trait_diplo_weight
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_urbanist
				}
				add_trait_no_notify = leader_trait_urbanist
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_utopian_idealist
				}
				add_trait_no_notify = leader_trait_utopian_idealist
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_surveyor
				}
				add_trait_no_notify = leader_trait_surveyor
			}
		}
	}
	if = {
		limit = {
			leader_class = scientist
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_great_researcher
				}
				add_trait_no_notify = leader_trait_great_researcher
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_surveyor
				}
				add_trait_no_notify = leader_trait_surveyor
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_midas_touch
				}
				add_trait_no_notify = leader_trait_midas_touch
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_collective_wisdom
				}
				add_trait_no_notify = leader_trait_collective_wisdom
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_xeno_cataloger
				}
				add_trait_no_notify = leader_trait_xeno_cataloger
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_frontier_adventurer
				}
				add_trait_no_notify = leader_trait_frontier_adventurer
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_truth_seeker
				}
				add_trait_no_notify = leader_trait_truth_seeker
			}
		}
	}
	if = {
		limit = {
			leader_class = commander
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_peacekeeper
				}
				add_trait_no_notify = leader_trait_peacekeeper
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_admiral_hells_heart
				}
				add_trait_no_notify = leader_trait_admiral_hells_heart
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_spacebender
				}
				add_trait_no_notify = leader_trait_spacebender
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_supreme_warrior
				}
				add_trait_no_notify = leader_trait_supreme_warrior
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_fortress_cracker
				}
				add_trait_no_notify = leader_trait_fortress_cracker
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_survivalist
				}
				add_trait_no_notify = leader_trait_survivalist
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_guerilla_tactics
				}
				add_trait_no_notify = leader_trait_guerilla_tactics
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_master_gunner
				}
				add_trait_no_notify = leader_trait_master_gunner
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_brilliant_shipwright
				}
				add_trait_no_notify = leader_trait_brilliant_shipwright
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_maven_of_war
				}
				add_trait_no_notify = leader_trait_maven_of_war
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_armorer
				}
				add_trait_no_notify = leader_trait_armorer
			}
			1 = {
				modifier = {
					factor = 0
					has_trait = leader_trait_military_overseer
				}
				add_trait_no_notify = leader_trait_military_overseer
			}
		}
	}
}