namespace = azur_R_vocaloid

country_event = {
	id = azur_R_vocaloid.01
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
	}
	
	immediate = {
		#创建领袖
		create_leader = {
			name = 初音未来
			species = event_target:azur_lane_vocaloid
			class = official  				#official/scientist/random_ruler/commander
			skill = 1
			set_age = 16
			traits = {
				trait = leader_azur_trait_miku
				trait = leader_azur_trait_miku_02
			}
			
			gender = indeterminable
			event_leader = no
			hide_age = no
			
			skip_background_generation = yes				#跳过背景生成
			custom_description = AL_R_miku_backstory
			custom_catch_phrase = AL_R_miku_phrase
			background_ethic = ethic_gestalt_consciousness
		}
		last_created_leader = {
			change_leader_portrait = AL_leader_初音未来
			set_leader_flag = azur_leader_miku  #领袖标记
			save_global_event_target_as = miku_leader #保存事件
			#新flag
			set_leader_flag = legendary_leader
			set_leader_flag = immune_to_negative_traits
			set_skill = 39
			add_trait_no_notify = random_common
			remove_all_traits = yes
			add_trait_no_notify = leader_azur_trait_miku
			add_trait_no_notify = leader_azur_trait_miku_02
			set_leader_flag = should_not_have_upkeep
		}
		#任命领导人
		assign_leader = last_created_leader
	}
}

#创建领袖
country_event = {
	id = azur_R_vocaloid.02
	is_triggered_only = yes
	hide_window = yes
	fire_only_once = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_miku
	}
	
	immediate = {
		#创建领袖
		create_leader = {
			name = 巡音流歌
			species = event_target:azur_lane_vocaloid
			class = scientist					#official/scientist/random_ruler/commander
			skill = 1
			set_age = 20
			traits = {
				trait = leader_azur_trait_luka
				trait = leader_azur_trait_luka_02
			}
			
			gender = indeterminable
			event_leader = no
			hide_age = no

			skip_background_generation = yes				#跳过背景生成
			custom_catch_phrase = AL_R_luka_phrase			#自定义
			custom_description = AL_R_luka_backstory		#背景词
			background_ethic = ethic_gestalt_consciousness
		}
		last_created_leader = {
			change_leader_portrait = AL_R_leader_巡音流歌
			set_leader_flag = azur_leader_luka  #领袖标记
			save_global_event_target_as = luka_leader #保存事件
			#新flag
			set_leader_flag = legendary_leader
			set_leader_flag = immune_to_negative_traits
			set_skill = 39
			add_trait_no_notify = random_common
			remove_all_traits = yes
			add_trait_no_notify = leader_azur_trait_luka
			add_trait_no_notify = leader_azur_trait_luka_02
			set_leader_flag = should_not_have_upkeep
		}
	}
}


#LUKA领袖技能
country_event = {
	id = azur_R_vocaloid.03
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_leader_miku
		exists = event_target:luka_leader
		event_target:luka_leader = {
			is_councilor = yes
		}
	}
	
	immediate = {
		random_list = {
			5 = { set_timed_country_flag = { flag = 然而什么都没有发生 days= 360 } }
			1 = { 
				add_random_research_option = {
                    add_progress = 1.00
                    area = physics
                    ignore_prereqs = no
					ignore_rare = no
                    fail_effects = {
                        add_monthly_resource_mult = {
                            resource = physics_research
                            value = 12
                        }
                    }
                }
			}
			1 = { 
				add_random_research_option = {
                    add_progress = 1.00
                    area = engineering
                    ignore_prereqs = no
					ignore_rare = no
                    fail_effects = {
                        add_monthly_resource_mult = {
                            resource = engineering_research
                            value = 12
                        }
                    }
                }
			}
			1 = { 
				add_random_research_option = {
                    add_progress = 1.00
                    area = society
                    ignore_prereqs = no
					ignore_rare = no
                    fail_effects = {
                        add_monthly_resource_mult = {
                            resource = society_research
                            value = 12
                        }
                    }
                }
			}
		}
	}
}


#复活
country_event = {
	id = azur_R_vocaloid.04
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = has_tr_hatsune_miku
		OR = {
			NOT = { exists = event_target:miku_leader }
			#内阁
			event_target:miku_leader = {
				is_ruler = no
			}
		}
	}
	
	immediate = {
		#击毙当前领袖
		random_owned_leader = {
			limit = { 
				is_councilor = yes
				is_ruler = yes
			}
			save_global_event_target_as = azur_leader_ruler
		}
		#创建领袖
		create_leader = {
			name = 初音未来
			species = event_target:azur_lane_vocaloid
			class = official  				#official/scientist/random_ruler/commander
			skill = 1
			set_age = 16
			traits = {
				trait = leader_azur_trait_miku
				trait = leader_azur_trait_miku_02
			}
			
			gender = indeterminable
			event_leader = no
			hide_age = no
			
			skip_background_generation = yes				#跳过背景生成
			custom_description = AL_R_miku_backstory
			custom_catch_phrase = AL_R_miku_phrase
			background_ethic = ethic_gestalt_consciousness
		}
		last_created_leader = {
			change_leader_portrait = AL_leader_初音未来
			set_leader_flag = azur_leader_miku  #领袖标记
			save_global_event_target_as = miku_leader #保存事件
			#新flag
			set_leader_flag = legendary_leader
			set_leader_flag = immune_to_negative_traits
			set_skill = 39
			add_trait_no_notify = random_common
			remove_all_traits = yes
			add_trait_no_notify = leader_azur_trait_miku
			add_trait_no_notify = leader_azur_trait_miku_02
			set_leader_flag = should_not_have_upkeep
		}
		#任命领导人
		assign_leader = last_created_leader
		#特质
		if = {
			limit = {
				has_tradition = tr_hatsune_miku_05
			}
			event_target:miku_leader = {
				remove_trait = leader_azur_trait_miku
				add_trait_no_notify = leader_azur_trait_miku_world_is_mine
			}
		}
		event_target:azur_leader_ruler = {
			exile_leader_as = azur_leader_ruler
		}
	}
}

#塞特质
country_event = {
	id = azur_R_vocaloid.05
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = has_tr_hatsune_miku
		has_tradition = tr_hatsune_miku_03
	}
	
	immediate = {
		every_country = {
			limit = {
				NOR = { 
					has_country_flag = azur_lane_gangqu_country
					has_country_flag = has_tr_hatsune_miku
				}
			}
			every_owned_leader = {
				limit = { 
					NOT = { has_leader_flag = 提款姬 }
					is_azur_lane_leader = no
				}
				add_trait = leader_azur_trait_miku_alien
				set_leader_flag = 提款姬
			}
		}
	}
}

#月检
country_event = {
	id = azur_R_vocaloid.06
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = has_tr_hatsune_miku
	}
	
	immediate = {
		country_event = { id = azur_R_vocaloid.04 }
		country_event = { id = azur_R_vocaloid.05 }
	}
}

#蔚蓝星球
country_event = {
	id = azur_R_vocaloid.07
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = has_tr_hatsune_miku
	}
	
	immediate = {
		capital_scope = {
			solar_system = {
				spawn_planet = {
					class = "pc_azur_miku_desert"  #星球类型
					location = owner.capital_scope
					orbit_location = yes
					orbit_angle_offset = 39               #角度
					orbit_distance_offset = 39           #距离
					size = 39
					has_ring = yes
					init_effect = {
						set_name = "pc_azur_miku_desert_01"
						set_planet_entity = {
							entity = "azur_miku_desert_planet"
							graphical_culture = no
						}
						surveyed = {
							set_surveyed = yes
							surveyor = FROM
						}
						set_all_comms_surveyed = yes
						clear_blockers = yes
						clear_deposits = yes
					}
				}
			}
		}
	}
}

planet_event = {
	id = azur_R_vocaloid.08
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_planet_class = pc_azur_miku_desert
		has_planet_flag = consecrated@space_owner
	}

	immediate = {
		remove_planet_flag = consecrated@space_owner
		switch = {
			trigger = has_modifier
			consecrated_quality_4 = {
				remove_modifier = consecrated_quality_4
				space_owner = {
					change_variable = {
						which = consecrated_variable
						value = -4
					}
				}
			}
			consecrated_quality_3 = {
				remove_modifier = consecrated_quality_3
				space_owner = {
					change_variable = {
						which = consecrated_variable
						value = -3
					}
				}
			}
			consecrated_quality_2 = {
				remove_modifier = consecrated_quality_2
				space_owner = {
					change_variable = {
						which = consecrated_variable
						value = -2
					}
				}
			}
			consecrated_quality_1 = {
				remove_modifier = consecrated_quality_1
				space_owner = {
					change_variable = {
						which = consecrated_variable
						value = -1
					}
				}
			}
		}
		space_owner = {
			remove_modifier = azur_R_consecrated_worlds
			change_variable = {
				which = num_consecrated_worlds
				value = -1
			}
			recalculate_consecrated_world_modifier = yes
		}
	}
}

#铃
country_event = {
	id = azur_R_vocaloid.100
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
	}
	
	immediate = {
		set_country_flag = azur_R_galactic_emperor
		#创建领袖
		create_leader = {
			class = commander
			species = event_target:azur_lane_vocaloid
			name = 镜音铃
			event_leader = yes
			skill = 39
			set_age = 14
			set_is_female = yes
			traits = {
				trait = leader_azur_trait_rin_01
				trait = leader_azur_trait_rin_02
			}
		}
		last_created_leader = {
			change_leader_portrait = AL_R_leader_镜音铃_莉莉安娜
			set_leader_flag = azur_leader_rin  #领袖标记
			save_global_event_target_as = rin_leader #保存事件
		}
		#任命秘书
		assign_leader = last_created_leader
		country_event = { id = azur_R_vocaloid.101 }
	}
}

#开局调整
country_event = {
	id = azur_R_vocaloid.101
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
	}
	
	immediate = {
		#成立共同体
		set_country_flag = galcom_form_aye
		add_to_galactic_community_no_message = yes
		#成立银河帝国
		country_event = { id = azur_R_vocaloid.102 }
		#帝制调整
	}
}

#成立银河帝国
country_event = {
	id = azur_R_vocaloid.102
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		# Deal with existing Custodian resolutions
		if = {
			limit = { is_active_resolution = resolution_custodian_united_front }
			set_country_flag = united_front_active
		}
		if = {
			limit = { is_active_resolution = resolution_custodian_ina }
			set_country_flag = custodian_ina_active
		}
		if = {
			limit = { is_active_resolution = resolution_custodian_gto }
			set_country_flag = custodian_gto_active
		}
		if = {
			limit = {
				OR = {
					is_active_resolution = resolution_custodian_gdf
					is_active_resolution = resolution_custodian_expand_gdf
				}
			}
			set_timed_country_flag = { # To avoid duplicate IA events
				flag = gdf_turned_into_armada
				days = 11
			}
			country_event = { id = emperor.51 days = 10 }
		}
		if = {
			limit = { is_active_resolution = resolution_custodian_galpol }
			set_timed_country_flag = { # To avoid duplicate ISD events
				flag = galpol_turned_into_isd
				days = 5
			}
			country_event = { id = emperor.71 days = 4 }
		}

		# Coronation
		save_event_target_as = gal_emperor
		country_event = { id = azur_R_vocaloid.103 }
	}
}

#修改设定
country_event = {
	id = azur_R_vocaloid.103
	title = "emperor.2.name"
	desc = {
		trigger = { is_gestalt = no }
		text = "emperor.2.normal.desc"
	}
	desc = {
		trigger = { is_machine_empire = yes }
		text = "emperor.2.machine.desc"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "emperor.2.hive.desc"
	}
	picture = GFX_evt_coronation
	show_sound = event_coronation

	is_triggered_only = yes

	immediate = {
		remove_modifier = gal_custodian
		if = {
			limit = { has_federation = yes }
			leave_alliance = { override_requirements = yes }
		}
		set_galactic_emperor = yes
		if = {
			limit = { has_country_flag = united_front_active }
			pass_resolution_no_cooldown = resolution_emperor_united_front
			remove_country_flag = united_front_active
		}
		if = {
			limit = { has_country_flag = custodian_ina_active }
			pass_resolution_no_cooldown = resolution_emperor_ina
			remove_country_flag = custodian_ina_active
		}
		if = {
			limit = { has_country_flag = custodian_gto_active }
			pass_resolution_no_cooldown = resolution_emperor_gto
			remove_country_flag = custodian_gto_active
		}
		random_country = {
			limit = { is_country_type = global_event }
			change_variable = {
				which = galactic_empires
				value = 1
			}
		}
		store_galactic_community_leader_backup_data = {
			FLAG = yes
			NAME = yes
			ETHICS = yes
			GOVERNMENT = yes
		}
		if = {
			limit = {
				is_gestalt = no
				is_megacorp = no
			}
			shift_ethic = "ethic_fanatic_authoritarian"
			#修改政体国策
			force_add_civic = civic_galactic_sovereign
			force_remove_civic = civic_azur_R_01
			force_remove_civic = civic_azur_R_02
			change_government = {
				authority = auth_azur_R_rin_dictatorial
			}
		}
		else_if = {
			limit = { is_gestalt = yes }
			force_add_civic = civic_galactic_sovereign
		}
		else_if = {
			limit = { is_megacorp = yes }
			shift_ethic = "ethic_fanatic_authoritarian"
			force_add_civic = civic_galactic_sovereign_megacorp
			change_government = {
				authority = auth_imperial
				cooldown = no
				remove_invalid_civics = yes
			}
		}
		set_government_cooldown = no
		set_name = random
		room_name_override = ""
		every_playable_country = {
			limit = {
				NOT = { is_same_value = root }
			}
			country_event = { id = emperor.3 }
		}
		pass_resolution_no_cooldown = resolution_emperor_by_election
	}

	option = {
		name = emperor.2.a
		add_resource = {
			influence = 250
		}
		if = {
			limit = {
				is_gestalt = yes
			}
			custom_tooltip = emperor.2.a.tooltip.gestalt
		}
		else_if = {
			limit = {
				is_megacorp = yes
			}
			custom_tooltip = emperor.2.a.tooltip.megacorp
		}
		else = {
			custom_tooltip = emperor.2.a.tooltip
		}
	}
}

#一歌你带我走吧一歌呜呜
country_event = {
	id = azur_R_vocaloid.200
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
	}
	
	immediate = {
		#创建领袖
		create_leader = {
			name = NAME_AL_R_Hoshino_Ichika
			species = event_target:azur_lane_leader_species
			class = official  				#official/scientist/random_ruler/commander
			skill = 1
			set_age = 16
			traits = {
				trait = leader_azur_trait_ichika_01
				trait = leader_trait_governor_gray
			}
			
			gender = female
			set_is_female = yes
			event_leader = no
			hide_age = no

			skip_background_generation = yes				#跳过背景生成
			custom_catch_phrase = AL_R_ichika_phrase		#自定义
			custom_description = AL_R_ichika_backstory		#背景词
			background_ethic = ethic_pacifist
		}
		last_created_leader = {
			change_leader_portrait = AL_R_leader_一歌_02
			set_leader_flag = azur_leader_ichika  #领袖标记
			save_global_event_target_as = ichika_leader #保存事件
			#新flag
			set_leader_flag = legendary_leader
			set_leader_flag = immune_to_negative_traits
			set_skill = 39
			add_trait_no_notify = random_common
			remove_all_traits = yes
			add_trait_no_notify = leader_azur_trait_ichika_01
			add_trait_no_notify = leader_trait_governor_gray
			set_leader_flag = should_not_have_upkeep
		}
		#首都建筑操作
		capital_scope = {
			#专属首府
			add_building = azur_R_building_ichika_capital
			set_planetary_ascension_tier = 10
		}
	}
}