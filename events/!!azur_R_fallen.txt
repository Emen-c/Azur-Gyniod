namespace = azur_R_fallen

#开局联络
country_event = {
	id = azur_R_fallen.1
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		exists = event_target:azur_R_fallen_empire
		NOT = { has_global_flag = have_azur_R_fallen }
	}
	
	immediate = {
		set_global_flag = have_azur_R_fallen
		event_target:azur_R_fallen_empire = {
			country_event = { id = azur_R_fallen.3 }
		}
		every_playable_country = {
			limit = {
				has_country_flag = azur_lane_gangqu_country
				NOT = { has_communications = event_target:azur_R_fallen_empire }
			}
			establish_communications_no_message = event_target:azur_R_fallen_empire
			establish_contact = {
				who = event_target:azur_R_fallen_empire
				location = event_target:azur_R_fallen_empire.capital_scope
			}
			#联络界面
			country_event = { id = azur_R_fallen.2	days = 1 }
		}
	}
}

#联络界面
country_event = {
	id = azur_R_fallen.2
	title = "TRANSMISSION"
	desc = azur_R_fallen.2.desc

	is_triggered_only = yes
	diplomatic = yes
	force_open = yes

	trigger = {
		has_country_flag = azur_lane_gangqu_country
		is_ai = no
	}

	picture_event_data = {
		portrait = event_target:azur_R_fallen_empire
		planet_background = event_target:azur_R_fallen_empire
		graphical_culture = event_target:azur_R_fallen_empire
		city_level = event_target:azur_R_fallen_empire
		room = event_target:azur_R_fallen_empire.ruler
	}

	option = {
		trigger = { has_country_flag = azur_lane_gangqu_country }
		name = azur_R_fallen.2.a
	}

	option = {
		name = azur_R_fallen.2.b
	}
	
	option = {
		name = azur_R_fallen.2.c
	}

}

#疆域
country_event = {
	id = azur_R_fallen.3
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		no_scope = {
			every_system = {
				limit = { 
					NOR = { 
						has_star_flag = azur_R_fallen_system_4
						has_star_flag = azur_R_fallen_system_3
						has_star_flag = azur_R_fallen_system_2
						has_star_flag = azur_R_fallen_capital_system
					}
					distance = {
						source = event_target:azur_R_fallen_system_home
						type = euclidean
						min_distance >= 1
						max_distance <= 48
					}
					NOT = { exists = owner }
				}
				create_azur_R_fallen_citadel = yes
				every_system_planet = {
					limit = {
						has_deposit_for = shipclass_mining_station
						has_mining_station = no
					}
					create_mining_station = {
						owner = event_target:azur_R_fallen_empire
					}
				}
				every_system_planet = {
					limit = {
						has_deposit_for = shipclass_research_station
						has_research_station = no
					}
					create_research_station = {
						owner = event_target:azur_R_fallen_empire
					}
				}
			}
		}
	}	
}

#刷船
country_event = {
	id = azur_R_fallen.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:azur_R_fallen_empire
		has_global_flag = have_azur_R_fallen
		#has_global_flag = azur_R_fallen_is_awakened
		NOT = { has_global_flag = has_azur_R_fallen_ship }
	}

	immediate = {
		set_timed_global_flag = { flag = has_azur_R_fallen_ship months = 25 }
		event_target:azur_R_fallen_empire = {
			if = {
				limit = {
					is_at_war = yes
				}
				capital_scope = {
					create_azur_R_fallen_fleet = yes
					create_azur_R_fallen_fleet = yes
					create_azur_R_fallen_armys = yes
					create_azur_R_fallen_armys = yes
					create_azur_R_fallen_construction_ship = yes
					create_azur_R_fallen_construction_ship = yes
				}
			}
		}
	}
}

#随机选择一名幸运AI
country_event = {
	id = azur_R_fallen.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:azur_R_fallen_empire
		has_global_flag = have_azur_R_fallen
		has_global_flag = azur_R_fallen_is_awakened
		NOT = { has_global_flag = is_war_with_ai_AL_R }
	}

	
	immediate = {
		set_timed_global_flag = {
			flag = is_war_with_ai_AL_R
			days = 180
		}
		random_country = {
			limit = {
				is_ai = yes
				is_country_type = default
			}
			save_event_target_as = azur_fallen_empire_war_ai
		}
		event_target:azur_R_fallen_empire = {
			if = {
				limit = {
					NOT = {
						is_at_war = yes
					}
				}
				declare_war = {
					target = event_target:azur_fallen_empire_war_ai
					name = "抹除存在"
					attacker_war_goal = "wg_ae_domination"
				}
			}
		}
	}
}

#觉醒事件
#后期时间觉醒前置
event = {
	id = azur_R_fallen.6
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		has_global_flag = have_azur_R_fallen
		NOT = { has_global_flag = azur_R_fallen_awakened }
	}

	immediate = {
		set_global_flag = azur_R_fallen_awakened
		event_target:azur_R_fallen_empire = {
			country_event = { id = azur_R_fallen.7 days = 360 random = 1440 }
		}
		every_playable_country = {
			limit = {
				has_country_flag = azur_lane_gangqu_country
			}
			add_modifier = {
				modifier = "azur_test_01"
				days = -1
			}
		}
	}
}

#觉醒
country_event = {
	id = azur_R_fallen.7
	hide_window = yes
	is_triggered_only = yes
	#fire_only_once = yes

	trigger = {
		exists = event_target:azur_R_fallen_empire
	}

	immediate = {
		set_country_type = awakened_fallen_empire
		set_country_flag = azur_R_awakened_fallen_empire
		set_global_flag = azur_R_fallen_is_awakened
		change_government = {
			civics = {
				civic = civic_revanchist_fervor
				civic = civic_ancient_caches_of_technology
			}
		}
		#刷船
		capital_scope = {
			create_azur_R_fallen_home_fleet = yes
			create_azur_R_fallen_fleet = yes
			create_azur_R_fallen_fleet = yes
			create_azur_R_fallen_construction_ship = yes
			create_azur_R_fallen_construction_ship = yes
		}
		
		#上堡垒
		every_system_within_border = {
			create_azur_R_fallen_citadel = yes
		}

		every_country = { 
			limit = {
				OR = {
					is_country_type = default
					is_country_type = fallen_empire
					is_country_type = awakened_fallen_empire
				}
				NOT = {
					has_country_flag = azur_lane_gangqu_country
				}
			}
			establish_communications_no_message = root
			root = { save_event_target_as = contact_empire }
			country_event = { id = action.1 days = 1 }
		}
		every_playable_country = {
			limit = {
				has_country_flag = azur_lane_gangqu_country
			}
			country_event = { id = azur_R_fallen.8 }
		}
		every_playable_country = {
			limit = {
				NOT = { has_country_flag = azur_lane_gangqu_country }
			}
			country_event = { id = fallen_empires_awakening.5 }
		}
	}
}

#觉醒通知
country_event = {
	id = azur_R_fallen.8
	title = "TRANSMISSION"
	desc = azur_R_fallen.8.desc

	picture_event_data = {
		portrait = event_target:azur_R_fallen_empire
		planet_background = event_target:azur_R_fallen_empire
		graphical_culture = event_target:azur_R_fallen_empire
		city_level = event_target:azur_R_fallen_empire
		room = event_target:azur_R_fallen_empire.ruler
	}
	diplomatic = yes
	force_open = yes
	is_triggered_only = yes
	show_sound = event_celebration

	option = {
		trigger = {
			has_country_flag = azur_lane_gangqu_country
		}
		name = azur_R_fallen.8.a
		custom_tooltip = azur_R_fallen.8.b
	}
	
	option = {
		name = azur_R_fallen.8.c
		custom_tooltip = azur_R_fallen.8.b
	}
	
	option = {
		name = azur_R_fallen.8.d
		custom_tooltip = azur_R_fallen.8.b
	}

}


#坐地起堡垒(
ship_event = {
	id = azur_R_fallen.9
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:azur_R_fallen_empire
		owner = {
			OR = {
				is_azur_fallen_empire = yes
				is_azur_awakened_fallen_empire = yes
			}
		}
	}

	#刷堡垒
	immediate = {
		solar_system = {
			create_azur_R_fallen_citadel = yes
			set_star_flag = azur_R_fallen_system_citadel
		}
	}
}

#接战移除非常规国家
country_event = {
	id = azur_R_fallen.10
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		This = {
			has_country_flag = azur_R_fallen_empire
		}
		From = {
			NOR = { 
				is_country_type = default
				is_country_type = default_ev
			}
			is_ai= yes
		}
		FromFromFrom = {
			NOT = { is_ship_class = shipclass_starbase }
		}
	}

	immediate = {
		From = {
			if = {
				limit = {
					NOT = {
						has_modifier = azur_R_fallen_modifiers_03
					}
				}
				add_modifier = { modifier = azur_R_fallen_modifiers_03 days = -1 }
			}
		}
		FromFromFrom = {
			set_mia = yes
		}
	}
}

#灾飞后续
country_event = {
	id = azur_R_fallen.11
	title = "azur_R_fallen.11.title"
	desc = azur_R_fallen.11.desc

	is_triggered_only = yes
	diplomatic = yes
	force_open = yes

	trigger = {
		exists = event_target:azur_R_fallen_empire
		is_ai = no
	}

	picture_event_data = {
		portrait = AL_leader_海伦娜meta
		planet_background = event_target:azur_R_fallen_empire
		graphical_culture = event_target:azur_R_fallen_empire
		city_level = event_target:azur_R_fallen_empire
		room = event_target:azur_R_fallen_empire.ruler
	}
	
	option = {
		name = azur_R_fallen.11.a
	}
	
	option = {
		name = azur_R_fallen.11.b
	}
	
	option = {
		name = azur_R_fallen.11.c
	}
}

#爆金币了
country_event = {
	id = azur_R_fallen.12
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_country_flag = azur_R_fallen_empire
	}

	immediate = {
		every_playable_country = {
			limit = { is_ai = no }
			country_event = { id = azur_R_fallen.13 days = 1 }
		}
	}
}

#后续
country_event = {
	id = azur_R_fallen.13
	title = "azur_R_fallen.13.title"
	desc = "azur_R_fallen.13.desc"

	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = AL_leader_约克城meta
		room = shroudwalkers_room
	}

	option = {
		name = azur_R_fallen.13.a
	}
	
	option = {
		name = azur_R_fallen.13.b
	}
	
	option = {
		name = azur_R_fallen.13.c
	}
}


