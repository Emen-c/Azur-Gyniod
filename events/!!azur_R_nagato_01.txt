namespace = azur_R_nagato
#长门专属事件
#局势强制绑定统治者
country_event = {
	id = azur_R_nagato.1
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
		has_country_flag = azur_R_situation_01_start
		OR = {
			NOT = { exists = event_target:changmen_leader }
			event_target:changmen_leader = {
				is_ruler = no
			}
		}
	}
	
	immediate = {
		random_owned_leader = {
			limit = { 
				is_councilor = yes
				is_ruler = yes
			}
			save_global_event_target_as = azur_leader_ruler
		}
		#重新生成
		if = {
			limit = {
				exists = event_target:changmen_leader
			}
			assign_leader = event_target:changmen_leader
		else_if = {
			limit = {
				NOT = {
					exists = event_target:changmen_leader
				}
			}
			#创建长门
			create_leader = {
				name = 长门
				species = event_target:azur_lane_leader_species
				class = official  				#official/scientist/random_ruler/commander
				skill = 1
				set_age = 16
				traits = {
					trait = leader_azur_R_changmen_01
				}
				
				gender = female
				set_is_female = yes
				event_leader = no
				hide_age = no

				custom_catch_phrase = AL_R_changmen_phrase			#自定义
				custom_description = AL_R_changmen_backstory		#背景词
				background_job = azur_R_politician
				background_ethic = ethic_egalitarian				#思潮
			}
			last_created_leader = {
				change_leader_portrait = AL_leader_长门
				set_leader_flag = azur_leader_changmen  #领袖标记
				save_global_event_target_as = changmen_leader #保存事件
				#新flag
				set_leader_flag = legendary_leader
				set_leader_flag = immune_to_negative_traits
				set_skill = 20
				add_trait_no_notify = random_common
				remove_all_traits = yes
				add_trait_no_notify = leader_azur_R_changmen_01
				set_leader_flag = should_not_have_upkeep
			}
			#任命秘书
			assign_leader = last_created_leader
			event_target:azur_leader_ruler = {
				exile_leader_as = azur_leader_ruler
			}
		}
		#加特质
		if = {
			limit = {
				has_country_flag = azur_R_stage_1_flag
			}
			event_target:changmen_leader = {
				add_trait = leader_azur_R_changmen_02
			}
		}
		if = {
			limit = {
				has_country_flag = azur_R_stage_7_flag
			}
			event_target:changmen_leader = {
				add_trait = leader_azur_R_changmen_03
			}
		}
	}
}

#长门开局事件
country_event = {
	id = azur_R_nagato.2
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}
	
	immediate = {
		#开始局势
		owner = {
			start_situation = {
				type = azur_R_situation_01
				target = this
			}
		}
		#首都建筑操作
		capital_scope = {
			#专属首府
			add_building = azur_R_building_colony_nagato_01
		}
	}
}

#局势阶段事件
#进入分支
country_event = {
	id = azur_R_nagato.3
	title = "azur_R_nagato.3.title"
	desc = "azur_R_nagato.3.desc"
	picture = GFX_azur_R_nagato_01
	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}

	option = {
		name = azur_R_nagato.3.a
		default_hide_option = yes
	}
}

#阶段二
country_event = {
	id = azur_R_nagato.4
	title = "azur_R_nagato.4.title"
	desc = "azur_R_nagato.4.desc"
	picture = GFX_azur_R_situation_01
	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}

	option = {
		name = azur_R_nagato.4.a
		default_hide_option = yes
	}
}

#阶段三/R
country_event = {
	id = azur_R_nagato.5
	title = "azur_R_nagato.5.title"
	desc = "azur_R_nagato.5.desc"
	picture = GFX_azur_R_nagato_02
	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}

	option = {
		name = azur_R_nagato.5.a
		default_hide_option = yes
	}
}

#阶段三/B
country_event = {
	id = azur_R_nagato.6
	title = "azur_R_nagato.6.title"
	desc = "azur_R_nagato.6.desc"
	picture = GFX_azur_R_nagato_03
	fire_only_once = yes

	is_triggered_only = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}

	option = {
		name = azur_R_nagato.6.a
		default_hide_option = yes
	}
}

#长门加特质-神子/樱之守护
country_event = {
	id = azur_R_nagato.7
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}
	
	immediate = {
		if = {
			limit = {
				has_country_flag = azur_R_stage_1_flag
			}
			event_target:changmen_leader = {
				add_trait = leader_azur_R_changmen_02
				change_background_ethic = ethic_authoritarian
			}
		}
		else_if = {
			limit = {
				has_country_flag = azur_R_stage_7_flag
			}
			event_target:changmen_leader = {
				add_trait = leader_azur_R_changmen_03
				change_background_ethic = ethic_egalitarian
			}
		}
	}
}

#其他重樱领袖特质
country_event = {
	id = azur_R_nagato.8
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
	}
	
	immediate = {
				
	}
}

####御神木变量####
#灵魂（收割）
planet_event = {
	id = azur_R_nagato.9
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		owner = {
			has_country_flag = azur_lane_gangqu_country
			has_country_flag = azur_lane_leader_changmen
			has_country_flag = azur_R_building_colony_nagato_03_r_built
			capital_scope = {
				has_building = azur_R_building_colony_nagato_03_r
			}
		}
	}
	
	immediate = {
		every_owned_pop = {
			prev = { owner = { change_variable = { which = azur_R_nagato_soul value = 1 } } }
		}
		owner = {
			capital_scope = {
				if = {
					limit = {
						has_modifier = azur_R_nagato_soul
					}
					remove_modifier = azur_R_nagato_soul
				}
				add_modifier = {
					modifier = azur_R_nagato_soul
					multiplier = owner.azur_R_nagato_soul
					days = -1
				}
			}
		}
		every_owned_pop = {
			kill_pop = yes
		}
	}
}

#信仰(每年根据人口数提供)
country_event = {
	id = azur_R_nagato.10
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = azur_lane_gangqu_country
		has_country_flag = azur_lane_leader_changmen
		has_country_flag = azur_R_building_colony_nagato_03_b_built
		capital_scope = {
			has_building = azur_R_building_colony_nagato_03_b
		}
	}
	
	immediate = {
		set_variable = { 
			which = azur_R_nagato_faith
			value = trigger:num_pops
		}
		capital_scope = {
			if = {
				limit = {
					has_modifier = azur_R_nagato_faith
				}
				remove_modifier = azur_R_nagato_faith
			}
			add_modifier = {
				modifier = azur_R_nagato_faith
				multiplier = owner.azur_R_nagato_faith
				days = -1
			}
		}
	}
}


